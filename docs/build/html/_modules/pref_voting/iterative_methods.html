<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" />

    <meta name="generator" content="sphinx-4.2.0, furo 2022.06.21"/>
        <title>pref_voting.iterative_methods - Preferential Voting Tools</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?digest=40978830699223671f4072448e654b5958f38b89" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">Preferential Voting Tools</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><div class="sidebar-scroll"><a class="sidebar-brand" href="../../index.html">
  
  
  <span class="sidebar-brand-text">Preferential Voting Tools</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Elections</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../profiles_overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../profiles.html">Profiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../profiles_with_ties.html">Profiles with Ties</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../margin_graphs.html">(Weighted) Majority Graphs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generate_profiles.html">Generate Profiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generate_weighted_majority_graphs.html">Generate Weighted Majority Graphs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Voting Methods</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../vms_overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scoring_methods.html">Positional Scoring Rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../iterative_methods.html">Iterative Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../c1_methods.html">C1 Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../margin_based_methods.html">Margin Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../combined_methods.html">Combined Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../other_methods.html">Other Methods</a></li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <h1>Source code for pref_voting.iterative_methods</h1><div class="highlight"><pre>
<span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    File: iterative_methods.py</span>
<span class="sd">    Author: Eric Pacuit (epacuit@umd.edu)</span>
<span class="sd">    Date: January 6, 2022</span>
<span class="sd">    Update: July 23, 2022</span>
<span class="sd">    </span>
<span class="sd">    Implementations of iterative voting methods.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">pref_voting.voting_method</span> <span class="kn">import</span>  <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pref_voting.voting_method</span> <span class="kn">import</span> <span class="n">_num_rank_last</span><span class="p">,</span> <span class="n">_num_rank_first</span>
<span class="kn">from</span> <span class="nn">pref_voting.profiles</span> <span class="kn">import</span>  <span class="n">_borda_score</span><span class="p">,</span> <span class="n">_find_updated_profile</span>
<span class="kn">from</span> <span class="nn">pref_voting.margin_based_methods</span> <span class="kn">import</span> <span class="n">split_cycle_faster</span>

<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">permutations</span><span class="p">,</span> <span class="n">product</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<div class="viewcode-block" id="instant_runoff"><a class="viewcode-back" href="../../iterative_methods.html#pref_voting.iterative_methods.instant_runoff">[docs]</a><span class="nd">@vm</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Instant Runoff&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">instant_runoff</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="n">curr_cands</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If there is a majority winner then that candidate is the  winner.  If there is no majority winner, then remove all candidates that are ranked first by the fewest number of voters.  Continue removing candidates with the fewest number first-place votes until there is a candidate with a majority of first place votes.  </span>
<span class="sd">    </span>
<span class="sd">    .. important::</span>
<span class="sd">        If there is  more than one candidate with the fewest number of first-place votes, then *all* such candidates are removed from the profile. </span>
<span class="sd">    </span>

<span class="sd">    Args:</span>
<span class="sd">        profile (Profile): An anonymous profile of linear orders on a set of candidates</span>
<span class="sd">        curr_cands (List[int], optional): If set, then find the winners for the profile restricted to the candidates in ``curr_cands``</span>

<span class="sd">    Returns: </span>
<span class="sd">        A sorted list of candidates</span>

<span class="sd">    .. seealso::</span>

<span class="sd">        Instant Runoff is also known as &quot;Ranked Choice&quot;, &quot;Hare&quot;, and &quot;Alternative Vote&quot;.</span>

<span class="sd">        Related functions:  :func:`pref_voting.iterative_methods.instant_runoff_tb`, :func:`pref_voting.iterative_methods.instant_runoff_put`, :func:`pref_voting.iterative_methods.instant_runoff_with_explanation`</span>
<span class="sd">   </span>
<span class="sd">    :Example: </span>

<span class="sd">    .. exec_code:: </span>

<span class="sd">        from pref_voting.profiles import Profile</span>
<span class="sd">        from pref_voting.iterative_methods import instant_runoff, ranked_choice, alterantive_vote, hare</span>
<span class="sd">        </span>
<span class="sd">        prof = Profile([[2, 1, 0], [0, 2, 1], [1, 2, 0]], [1, 2, 2])</span>

<span class="sd">        prof.display()</span>
<span class="sd">        instant_runoff.display(prof)</span>
<span class="sd">        ranked_choice.display(prof)</span>
<span class="sd">        alterantive_vote.display(prof)</span>
<span class="sd">        hare.display(prof)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># need the total number of all candidates in a profile to check when all candidates have been removed   </span>
    <span class="n">num_cands</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">num_cands</span> 
    
    <span class="n">candidates</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">curr_cands</span>
    <span class="n">cands_to_ignore</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">curr_cands</span><span class="p">])</span>

    <span class="n">strict_maj_size</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">strict_maj_size</span><span class="p">()</span>
    
    <span class="n">rs</span><span class="p">,</span> <span class="n">rcounts</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">rankings_counts</span> <span class="c1"># get all the ranking data</span>
    

    <span class="n">winners</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> 
               <span class="k">if</span> <span class="n">_num_rank_first</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="n">rcounts</span><span class="p">,</span> <span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">strict_maj_size</span><span class="p">]</span>

    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">winners</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">plurality_scores</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="n">_num_rank_first</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="n">rcounts</span><span class="p">,</span> <span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> 
                            <span class="k">if</span>  <span class="ow">not</span> <span class="n">isin</span><span class="p">(</span><span class="n">cands_to_ignore</span><span class="p">,</span><span class="n">c</span><span class="p">)}</span>  
        <span class="n">min_plurality_score</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">plurality_scores</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">lowest_first_place_votes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">plurality_scores</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> 
                                             <span class="k">if</span>  <span class="n">plurality_scores</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">==</span> <span class="n">min_plurality_score</span><span class="p">])</span>

        <span class="c1"># remove cands with lowest plurality score</span>
        <span class="n">cands_to_ignore</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">lowest_first_place_votes</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cands_to_ignore</span><span class="p">)</span> <span class="o">==</span> <span class="n">num_cands</span><span class="p">:</span> <span class="c1"># removed all of the candidates </span>
            <span class="n">winners</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">lowest_first_place_votes</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">winners</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> 
                       <span class="k">if</span> <span class="ow">not</span> <span class="n">isin</span><span class="p">(</span><span class="n">cands_to_ignore</span><span class="p">,</span><span class="n">c</span><span class="p">)</span> <span class="ow">and</span> <span class="n">_num_rank_first</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="n">rcounts</span><span class="p">,</span> <span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">strict_maj_size</span><span class="p">]</span>
     
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">winners</span><span class="p">)</span></div>

<span class="c1"># Create some aliases for instant runoff</span>
<span class="n">instant_runoff</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="s2">&quot;Hare&quot;</span><span class="p">)</span>
<span class="n">hare</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">instant_runoff</span><span class="p">)</span>
<span class="n">instant_runoff</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="s2">&quot;Ranked Choice&quot;</span><span class="p">)</span>
<span class="n">ranked_choice</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">instant_runoff</span><span class="p">)</span>
<span class="n">instant_runoff</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="s2">&quot;Alternative Vote&quot;</span><span class="p">)</span>
<span class="n">alterantive_vote</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">instant_runoff</span><span class="p">)</span>

<span class="c1"># reset the name Instant Runoff</span>
<span class="n">instant_runoff</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="s2">&quot;Instant Runoff&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="instant_runoff_tb"><a class="viewcode-back" href="../../iterative_methods.html#pref_voting.iterative_methods.instant_runoff_tb">[docs]</a><span class="nd">@vm</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Instant Runoff TB&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">instant_runoff_tb</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="n">curr_cands</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">tie_breaker</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Instant Runoff (``instant_runoff``) with tie breaking:  If there is  more than one candidate with the fewest number of first-place votes, then remove the candidate with lowest in the tie_breaker ranking from the profile.</span>

<span class="sd">    Args:</span>
<span class="sd">        profile (Profile): An anonymous profile of linear orders on a set of candidates</span>
<span class="sd">        curr_cands (List[int], optional): If set, then find the winners for the profile restricted to the candidates in ``curr_cands``</span>
<span class="sd">        tie_breaker (List[int]): A list of the candidates in the profile to be used as a tiebreaker.</span>

<span class="sd">    Returns: </span>
<span class="sd">        A sorted list of candidates</span>
<span class="sd">   </span>
<span class="sd">    :Example: </span>

<span class="sd">    .. exec_code:: </span>

<span class="sd">        from pref_voting.profiles import Profile</span>
<span class="sd">        from pref_voting.iterative_methods import instant_runoff, instant_runoff_tb</span>
<span class="sd">        </span>
<span class="sd">        prof = Profile([[1, 2, 0], [2, 1, 0], [0, 1, 2]], [1, 1, 1])</span>

<span class="sd">        prof.display()</span>
<span class="sd">        print(&quot;no tiebreaker&quot;)</span>
<span class="sd">        instant_runoff.display(prof)</span>
<span class="sd">        print(&quot;tie_breaker = [0, 1, 2]&quot;)</span>
<span class="sd">        instant_runoff_tb.display(prof) </span>
<span class="sd">        print(&quot;tie_breaker = [1, 2, 0]&quot;)</span>
<span class="sd">        instant_runoff_tb.display(prof, tie_breaker=[1, 2, 0])</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># the tie_breaker is any linear order (i.e., list) of the candidates</span>
    <span class="n">tb</span> <span class="o">=</span> <span class="n">tie_breaker</span> <span class="k">if</span> <span class="n">tie_breaker</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">num_cands</span><span class="p">))</span>
    
    <span class="c1"># need the total number of all candidates in a profile to check when all candidates have been removed   </span>
    <span class="n">num_cands</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">num_cands</span> 
    
    <span class="n">candidates</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">curr_cands</span>
    <span class="n">cands_to_ignore</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">curr_cands</span><span class="p">])</span>

    <span class="n">strict_maj_size</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">strict_maj_size</span><span class="p">()</span>
    
    <span class="n">rs</span><span class="p">,</span> <span class="n">rcounts</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">rankings_counts</span> <span class="c1"># get all the ranking data</span>
    
    <span class="n">winners</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> 
               <span class="k">if</span> <span class="n">_num_rank_first</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="n">rcounts</span><span class="p">,</span> <span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">strict_maj_size</span><span class="p">]</span>

    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">winners</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">plurality_scores</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="n">_num_rank_first</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="n">rcounts</span><span class="p">,</span> <span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">isin</span><span class="p">(</span><span class="n">cands_to_ignore</span><span class="p">,</span><span class="n">c</span><span class="p">)}</span>  
        <span class="n">min_plurality_score</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">plurality_scores</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">lowest_first_place_votes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">plurality_scores</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> 
                                             <span class="k">if</span> <span class="n">plurality_scores</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">==</span> <span class="n">min_plurality_score</span><span class="p">])</span>
        
        <span class="n">cand_to_remove</span> <span class="o">=</span> <span class="n">lowest_first_place_votes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">lowest_first_place_votes</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span> 
            <span class="k">if</span> <span class="n">tb</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tb</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">cand_to_remove</span><span class="p">):</span>
                <span class="n">cand_to_remove</span> <span class="o">=</span> <span class="n">c</span>

        <span class="c1"># remove cands with lowest plurality winners</span>
        <span class="n">cands_to_ignore</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">cand_to_remove</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cands_to_ignore</span><span class="p">)</span> <span class="o">==</span> <span class="n">num_cands</span><span class="p">:</span> <span class="c1">#all the candidates where removed</span>
            <span class="n">winners</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">lowest_first_place_votes</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">winners</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> 
                       <span class="k">if</span> <span class="ow">not</span> <span class="n">isin</span><span class="p">(</span><span class="n">cands_to_ignore</span><span class="p">,</span><span class="n">c</span><span class="p">)</span> <span class="ow">and</span> <span class="n">_num_rank_first</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="n">rcounts</span><span class="p">,</span> <span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">strict_maj_size</span><span class="p">]</span>
     
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">winners</span><span class="p">)</span></div>


<div class="viewcode-block" id="instant_runoff_put"><a class="viewcode-back" href="../../iterative_methods.html#pref_voting.iterative_methods.instant_runoff_put">[docs]</a><span class="nd">@vm</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Instant Runoff PUT&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">instant_runoff_put</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="n">curr_cands</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Instant Runoff (:fun:`instant_runoff`) with parallel universe tie-breaking (PUT).  Apply the Instant Runoff method with a tie-breaker for each possible linear order over the candidates. </span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        profile (Profile): An anonymous profile of linear orders on a set of candidates</span>
<span class="sd">        curr_cands (List[int], optional): If set, then find the winners for the profile restricted to the candidates in ``curr_cands``</span>

<span class="sd">    Returns: </span>
<span class="sd">        A sorted list of candidates</span>

<span class="sd">    .. warning:: </span>
<span class="sd">        This will take a long time on profiles with many candidates. </span>

<span class="sd">    :Example: </span>

<span class="sd">    .. exec_code:: </span>

<span class="sd">        from pref_voting.profiles import Profile</span>
<span class="sd">        from pref_voting.iterative_methods import instant_runoff, instant_runoff_tb, instant_runoff_put</span>
<span class="sd">        </span>
<span class="sd">        prof = Profile([[1, 2, 0], [2, 1, 0], [0, 1, 2]], [1, 1, 1])</span>

<span class="sd">        prof.display()</span>
<span class="sd">        print(&quot;no tiebreaker&quot;)</span>
<span class="sd">        instant_runoff.display(prof)</span>
<span class="sd">        print(&quot;tie_breaker = [0, 1, 2]&quot;)</span>
<span class="sd">        instant_runoff_tb.display(prof, tie_breaker=[0, 1, 2]) </span>
<span class="sd">        print(&quot;tie_breaker = [0, 2, 1]&quot;)</span>
<span class="sd">        instant_runoff_tb.display(prof, tie_breaker=[0, 2, 1])</span>
<span class="sd">        print(&quot;tie_breaker = [1, 0, 2]&quot;)</span>
<span class="sd">        instant_runoff_tb.display(prof, tie_breaker=[1, 0, 2])</span>
<span class="sd">        print(&quot;tie_breaker = [1, 2, 0]&quot;)</span>
<span class="sd">        instant_runoff_tb.display(prof, tie_breaker=[1, 2, 0])</span>
<span class="sd">        print(&quot;tie_breaker = [2, 0, 1]&quot;)</span>
<span class="sd">        instant_runoff_tb.display(prof, tie_breaker=[2, 0, 1])</span>
<span class="sd">        print(&quot;tie_breaker = [2, 1, 0]&quot;)</span>
<span class="sd">        instant_runoff_tb.display(prof, tie_breaker=[2, 1, 0])</span>
<span class="sd">        print()</span>
<span class="sd">        instant_runoff_put.display(prof)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">candidates</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">curr_cands</span>
    <span class="n">cands_to_ignore</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">curr_cands</span><span class="p">])</span>
    
    <span class="n">strict_maj_size</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">strict_maj_size</span><span class="p">()</span>
    
    <span class="n">rs</span><span class="p">,</span> <span class="n">rcounts</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">rankings_counts</span> <span class="c1"># get all the ranking data</span>
        
    <span class="n">winners</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> 
               <span class="k">if</span> <span class="n">_num_rank_first</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="n">rcounts</span><span class="p">,</span> <span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">strict_maj_size</span><span class="p">]</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">winners</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># run Instant Runoff with tie-breaker for each permulation of candidates</span>
        <span class="k">for</span> <span class="n">tb</span> <span class="ow">in</span> <span class="n">permutations</span><span class="p">(</span><span class="n">candidates</span><span class="p">):</span>
            <span class="n">winners</span> <span class="o">+=</span> <span class="n">instant_runoff_tb</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="n">curr_cands</span> <span class="o">=</span> <span class="n">curr_cands</span><span class="p">,</span> <span class="n">tie_breaker</span> <span class="o">=</span> <span class="n">tb</span><span class="p">)</span> 
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">winners</span><span class="p">)))</span></div>


<span class="c1"># Create some aliases for instant runoff</span>
<span class="n">instant_runoff_put</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="s2">&quot;Hare PUT&quot;</span><span class="p">)</span>
<span class="n">hare_put</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">instant_runoff_put</span><span class="p">)</span>
<span class="n">instant_runoff_put</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="s2">&quot;Ranked Choice PUT&quot;</span><span class="p">)</span>
<span class="n">ranked_choice_put</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">instant_runoff_put</span><span class="p">)</span>

<span class="c1"># reset the name Instant Runoff</span>
<span class="n">instant_runoff_put</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="s2">&quot;Instant Runoff PUT&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="instant_runoff_with_explanation"><a class="viewcode-back" href="../../iterative_methods.html#pref_voting.iterative_methods.instant_runoff_with_explanation">[docs]</a><span class="k">def</span> <span class="nf">instant_runoff_with_explanation</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="n">curr_cands</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Instant Runoff with an explanation. In addition to the winner(s), return the order in which the candidates are eliminated as a list of lists.    </span>

<span class="sd">    Args:</span>
<span class="sd">        profile (Profile): An anonymous profile of linear orders on a set of candidates</span>
<span class="sd">        curr_cands (List[int], optional): If set, then find the winners for the profile restricted to the candidates in ``curr_cands``</span>

<span class="sd">    Returns: </span>
<span class="sd">        A sorted list of candidates</span>

<span class="sd">        A list describing the order in which candidates are eliminated</span>

<span class="sd">    :Example: </span>

<span class="sd">    .. exec_code:: </span>

<span class="sd">        from pref_voting.profiles import Profile</span>
<span class="sd">        from pref_voting.iterative_methods import instant_runoff, instant_runoff_with_explanation</span>


<span class="sd">        prof = Profile([[2, 1, 0], [0, 2, 1], [1, 2, 0]], [1, 2, 2])</span>
<span class="sd">        prof.display()</span>
<span class="sd">        instant_runoff.display(prof)</span>
<span class="sd">        ws, exp = instant_runoff_with_explanation(prof)</span>
<span class="sd">        print(f&quot;winning set: {ws}&quot;)</span>
<span class="sd">        print(f&quot;order of elimination: {exp}&quot;)</span>

<span class="sd">        prof = Profile([[1, 2, 0], [2, 1, 0], [0, 1, 2]], [1, 1, 1])</span>
<span class="sd">        prof.display()</span>
<span class="sd">        instant_runoff.display(prof)</span>
<span class="sd">        ws, exp = instant_runoff_with_explanation(prof)</span>
<span class="sd">        print(f&quot;winning set: {ws}&quot;)</span>
<span class="sd">        print(f&quot;order of elimination: {exp}&quot;)</span>

<span class="sd">        prof = Profile([[2, 0, 1, 3], [2, 0, 3, 1], [3, 0, 1, 2],  [3, 2, 1, 0], [0, 2, 1, 3]], [1, 1, 1, 1, 1])</span>
<span class="sd">        prof.display()</span>
<span class="sd">        instant_runoff.display(prof)</span>
<span class="sd">        ws, exp = instant_runoff_with_explanation(prof)</span>
<span class="sd">        print(f&quot;winning set: {ws}&quot;)</span>
<span class="sd">        print(f&quot;order of elimination: {exp}&quot;)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># need the total number of all candidates in a profile to check when all candidates have been removed   </span>
    <span class="n">num_cands</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">num_cands</span> 
    
    <span class="n">candidates</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">curr_cands</span>
    <span class="n">cands_to_ignore</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">curr_cands</span><span class="p">])</span>

    <span class="n">strict_maj_size</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">strict_maj_size</span><span class="p">()</span>
    
    <span class="n">rs</span><span class="p">,</span> <span class="n">rcounts</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">rankings_counts</span> <span class="c1"># get all the ranking data</span>
    

    <span class="n">winners</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> 
               <span class="k">if</span> <span class="n">_num_rank_first</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="n">rcounts</span><span class="p">,</span> <span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">strict_maj_size</span><span class="p">]</span>
    <span class="n">elims_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">winners</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">plurality_scores</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="n">_num_rank_first</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="n">rcounts</span><span class="p">,</span> <span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> 
                            <span class="k">if</span>  <span class="ow">not</span> <span class="n">isin</span><span class="p">(</span><span class="n">cands_to_ignore</span><span class="p">,</span><span class="n">c</span><span class="p">)}</span>  
        <span class="n">min_plurality_score</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">plurality_scores</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">lowest_first_place_votes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">plurality_scores</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> 
                                             <span class="k">if</span>  <span class="n">plurality_scores</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">==</span> <span class="n">min_plurality_score</span><span class="p">])</span>

        <span class="n">elims_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">lowest_first_place_votes</span><span class="p">))</span>

        <span class="c1"># remove cands with lowest plurality winners</span>
        <span class="n">cands_to_ignore</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">lowest_first_place_votes</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cands_to_ignore</span><span class="p">)</span> <span class="o">==</span> <span class="n">num_cands</span><span class="p">:</span> <span class="c1"># removed all of the candidates </span>
            <span class="n">winners</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">lowest_first_place_votes</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">winners</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> 
                       <span class="k">if</span> <span class="ow">not</span> <span class="n">isin</span><span class="p">(</span><span class="n">cands_to_ignore</span><span class="p">,</span><span class="n">c</span><span class="p">)</span> <span class="ow">and</span> <span class="n">_num_rank_first</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="n">rcounts</span><span class="p">,</span> <span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">strict_maj_size</span><span class="p">]</span>
     
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">winners</span><span class="p">),</span> <span class="n">elims_list</span></div>


<div class="viewcode-block" id="plurality_with_runoff"><a class="viewcode-back" href="../../iterative_methods.html#pref_voting.iterative_methods.plurality_with_runoff">[docs]</a><span class="nd">@vm</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;PluralityWRunoff&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">plurality_with_runoff</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="n">curr_cands</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;If there is a majority winner then that candidate is the plurality with runoff winner. If there is no majority winner, then hold a runoff with  the top two candidates: either two (or more candidates) with the most first place votes or the candidate with the most first place votes and the candidate with the 2nd highest first place votes are ranked first by the fewest number of voters.   A candidate is a Plurality with Runoff winner in the profile restricted to ``curr_cands`` if it is a winner in a runoff between two pairs of first- or second- ranked candidates. If the candidates are all tied for the most first place votes, then all candidates are winners.</span>
<span class="sd">        </span>
<span class="sd">    Args:</span>
<span class="sd">        profile (Profile): An anonymous profile of linear orders on a set of candidates</span>
<span class="sd">        curr_cands (List[int], optional): If set, then find the winners for the profile restricted to the candidates in ``curr_cands``</span>

<span class="sd">    Returns: </span>
<span class="sd">        A sorted list of candidates</span>
<span class="sd">        </span>
<span class="sd">    .. note:: </span>
<span class="sd">        Plurality with Runoff is the same as Instant Runoff when there are 3 candidates, but give different answers with 4 or more candidates. </span>

<span class="sd">    :Example: </span>

<span class="sd">    .. exec_code:: </span>

<span class="sd">        from pref_voting.profiles import Profile</span>
<span class="sd">        from pref_voting.iterative_methods import instant_runoff, plurality_with_runoff</span>

<span class="sd">        prof = Profile([[0, 1, 2, 3], [3, 1, 2, 0], [2, 0, 3, 1], [1, 2, 3, 0], [2, 3, 0, 1], [0, 3, 2, 1]], [2, 1, 2, 2, 1, 2])</span>
<span class="sd">        prof.display()</span>
<span class="sd">        instant_runoff.display(prof)</span>
<span class="sd">        plurality_with_runoff.display(prof)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>    

    <span class="n">curr_cands</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">curr_cands</span>
    
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">curr_cands</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> 
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">curr_cands</span><span class="p">)</span>
    
    <span class="n">plurality_scores</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">plurality_scores</span><span class="p">(</span><span class="n">curr_cands</span> <span class="o">=</span> <span class="n">curr_cands</span><span class="p">)</span>  

    <span class="n">max_plurality_score</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">plurality_scores</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    
    <span class="n">first</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">curr_cands</span> <span class="k">if</span> <span class="n">plurality_scores</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">==</span> <span class="n">max_plurality_score</span><span class="p">]</span>
    <span class="n">second</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">first</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">second_plurality_score</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">plurality_scores</span><span class="o">.</span><span class="n">values</span><span class="p">())))[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">second</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">curr_cands</span> <span class="k">if</span> <span class="n">plurality_scores</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">==</span> <span class="n">second_plurality_score</span><span class="p">]</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">second</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">all_runoff_pairs</span> <span class="o">=</span> <span class="n">product</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="n">all_runoff_pairs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">)</span> <span class="k">for</span> <span class="n">c1</span><span class="p">,</span><span class="n">c2</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">first</span><span class="p">)</span> <span class="k">if</span> <span class="n">c1</span> <span class="o">!=</span> <span class="n">c2</span><span class="p">]</span>

    <span class="n">winners</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span> <span class="ow">in</span> <span class="n">all_runoff_pairs</span><span class="p">:</span> 
        
        <span class="k">if</span> <span class="n">profile</span><span class="o">.</span><span class="n">margin</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">winners</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">profile</span><span class="o">.</span><span class="n">margin</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">winners</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">profile</span><span class="o">.</span><span class="n">margin</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">winners</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span>
            <span class="n">winners</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">winners</span><span class="p">)))</span></div>


<div class="viewcode-block" id="coombs"><a class="viewcode-back" href="../../iterative_methods.html#pref_voting.iterative_methods.coombs">[docs]</a><span class="nd">@vm</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Coombs&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">coombs</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="n">curr_cands</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;If there is a majority winner then that candidate is the Coombs winner.     If there is no majority winner, then remove all candidates that are ranked last by the greatest number of voters.  Continue removing candidates with the most last-place votes until there is a candidate with a majority of first place votes.  </span>
<span class="sd">    </span>
<span class="sd">    .. important::</span>
<span class="sd">        If there is  more than one candidate with the largest number of last-place votes, then *all* such candidates are removed from the profile. </span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        profile (Profile): An anonymous profile of linear orders on a set of candidates</span>
<span class="sd">        curr_cands (List[int], optional): If set, then find the winners for the profile restricted to the candidates in ``curr_cands``</span>

<span class="sd">    Returns: </span>
<span class="sd">        A sorted list of candidates</span>

<span class="sd">    .. seealso::</span>

<span class="sd">        :func:`pref_voting.iterative_methods.coombs_with_tb`, :func:`pref_voting.iterative_methods.coomb_put`, :func:`pref_voting.iterative_methods.coombs_with_explanation`</span>
<span class="sd">   </span>
<span class="sd">    :Example: </span>

<span class="sd">    .. exec_code:: </span>

<span class="sd">        from pref_voting.profiles import Profile</span>
<span class="sd">        from pref_voting.iterative_methods import instant_runoff, coombs</span>
<span class="sd">        </span>
<span class="sd">        prof = Profile([[2, 1, 0], [0, 2, 1], [1, 2, 0]], [1, 2, 2])</span>

<span class="sd">        prof.display()</span>
<span class="sd">        coombs.display(prof)</span>
<span class="sd">        instant_runoff.display(prof)</span>

<span class="sd">    &quot;&quot;&quot;</span>   

    <span class="c1"># need the total number of all candidates in a profile to check when all candidates have been removed   </span>
    <span class="n">num_cands</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">num_cands</span> 
    
    <span class="n">candidates</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">curr_cands</span>
    <span class="n">cands_to_ignore</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">curr_cands</span><span class="p">])</span>

    <span class="n">strict_maj_size</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">strict_maj_size</span><span class="p">()</span>
    
    <span class="n">rs</span><span class="p">,</span> <span class="n">rcounts</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">rankings_counts</span> <span class="c1"># get all the ranking data</span>
    
    <span class="n">winners</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> 
               <span class="k">if</span> <span class="n">_num_rank_first</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="n">rcounts</span><span class="p">,</span> <span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">strict_maj_size</span><span class="p">]</span>

    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">winners</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        
        <span class="n">last_place_scores</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="n">_num_rank_last</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="n">rcounts</span><span class="p">,</span> <span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> 
                             <span class="k">if</span> <span class="ow">not</span> <span class="n">isin</span><span class="p">(</span><span class="n">cands_to_ignore</span><span class="p">,</span><span class="n">c</span><span class="p">)}</span>  
        <span class="n">max_last_place_score</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">last_place_scores</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">greatest_last_place_votes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">last_place_scores</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> 
                                              <span class="k">if</span>  <span class="n">last_place_scores</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">==</span> <span class="n">max_last_place_score</span><span class="p">])</span>

        <span class="c1"># remove candidates ranked last by the greatest number of voters</span>
        <span class="n">cands_to_ignore</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">greatest_last_place_votes</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cands_to_ignore</span><span class="p">)</span> <span class="o">==</span> <span class="n">num_cands</span><span class="p">:</span> <span class="c1"># removed all candidates </span>
            <span class="n">winners</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">greatest_last_place_votes</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">winners</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> 
                       <span class="k">if</span> <span class="ow">not</span> <span class="n">isin</span><span class="p">(</span><span class="n">cands_to_ignore</span><span class="p">,</span><span class="n">c</span><span class="p">)</span> <span class="ow">and</span> <span class="n">_num_rank_first</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="n">rcounts</span><span class="p">,</span> <span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">strict_maj_size</span><span class="p">]</span>

    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">winners</span><span class="p">)</span></div>


<div class="viewcode-block" id="coombs_tb"><a class="viewcode-back" href="../../iterative_methods.html#pref_voting.iterative_methods.coombs_tb">[docs]</a><span class="nd">@vm</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Coombs TB&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">coombs_tb</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="n">curr_cands</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">tie_breaker</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Coombs with a fixed tie-breaking rule: The tie-breaking rule is any linear order (i.e., list) of the candidates.  The default rule is to order the candidates as follows: 0,....,num_cands-1.</span>

<span class="sd">    Args:</span>
<span class="sd">        profile (Profile): An anonymous profile of linear orders on a set of candidates</span>
<span class="sd">        curr_cands (List[int], optional): If set, then find the winners for the profile restricted to the candidates in ``curr_cands``</span>
<span class="sd">        tie_breaker (List[int]): A list of the candidates in the profile to be used as a tiebreaker.</span>

<span class="sd">    Returns: </span>

<span class="sd">        A sorted list of candidates</span>

<span class="sd">    :Example: </span>

<span class="sd">    .. exec_code:: </span>

<span class="sd">        from pref_voting.profiles import Profile</span>
<span class="sd">        from pref_voting.iterative_methods import coombs, coombs_tb</span>
<span class="sd">        </span>
<span class="sd">        prof = Profile([[2, 0, 1], [0, 2, 1], [1, 0, 2], [2, 1, 0], [0, 1, 2]], [1, 1, 1, 2, 1])</span>
<span class="sd">        prof.display()</span>
<span class="sd">        print(&quot;no tiebreaker&quot;)</span>
<span class="sd">        coombs.display(prof)</span>
<span class="sd">        print(&quot;tie_breaker = [0, 1, 2]&quot;)</span>
<span class="sd">        coombs_tb.display(prof) </span>
<span class="sd">        print(&quot;tie_breaker = [2, 1, 0]&quot;)</span>
<span class="sd">        coombs_tb.display(prof, tie_breaker=[2, 1, 0])</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># the tie_breaker is any linear order (i.e., list) of the candidates</span>
    <span class="n">tb</span> <span class="o">=</span> <span class="n">tie_breaker</span> <span class="k">if</span> <span class="n">tie_breaker</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">num_cands</span><span class="p">))</span>

    <span class="n">num_cands</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">num_cands</span>   
    <span class="n">candidates</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">curr_cands</span>
    <span class="n">cands_to_ignore</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">curr_cands</span><span class="p">])</span>

    <span class="n">strict_maj_size</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">strict_maj_size</span><span class="p">()</span>
    
    <span class="n">rs</span><span class="p">,</span> <span class="n">rcounts</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">rankings_counts</span> <span class="c1"># get all the ranking data</span>

    <span class="n">winners</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> 
               <span class="k">if</span> <span class="n">_num_rank_first</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="n">rcounts</span><span class="p">,</span> <span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">strict_maj_size</span><span class="p">]</span>

    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">winners</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        
        <span class="n">last_place_scores</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="n">_num_rank_last</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="n">rcounts</span><span class="p">,</span> <span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> 
                             <span class="k">if</span> <span class="ow">not</span> <span class="n">isin</span><span class="p">(</span><span class="n">cands_to_ignore</span><span class="p">,</span><span class="n">c</span><span class="p">)}</span>  
        <span class="n">max_last_place_score</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">last_place_scores</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">greatest_last_place_votes</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">last_place_scores</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">last_place_scores</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">==</span> <span class="n">max_last_place_score</span><span class="p">]</span>

        <span class="c1"># select the candidate to remove using the tie-breaking rule (a linear order over the candidates)</span>
        <span class="n">cand_to_remove</span> <span class="o">=</span> <span class="n">greatest_last_place_votes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">greatest_last_place_votes</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span> 
            <span class="k">if</span> <span class="n">tb</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tb</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">cand_to_remove</span><span class="p">):</span>
                <span class="n">cand_to_remove</span> <span class="o">=</span> <span class="n">c</span>
        
        <span class="c1"># remove candidates ranked last by the greatest number of voters</span>
        <span class="n">cands_to_ignore</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">cand_to_remove</span><span class="p">])),</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cands_to_ignore</span><span class="p">)</span> <span class="o">==</span> <span class="n">num_cands</span><span class="p">:</span>
            <span class="n">winners</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">greatest_last_place_votes</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">winners</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> 
                       <span class="k">if</span> <span class="ow">not</span> <span class="n">isin</span><span class="p">(</span><span class="n">cands_to_ignore</span><span class="p">,</span><span class="n">c</span><span class="p">)</span> <span class="ow">and</span> <span class="n">_num_rank_first</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="n">rcounts</span><span class="p">,</span> <span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">strict_maj_size</span><span class="p">]</span>

    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">winners</span><span class="p">)</span></div>

<div class="viewcode-block" id="coombs_put"><a class="viewcode-back" href="../../iterative_methods.html#pref_voting.iterative_methods.coombs_put">[docs]</a><span class="nd">@vm</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Coombs PUT&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">coombs_put</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="n">curr_cands</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Coombs with parallel universe tie-breaking (PUT).  Apply the Coombs method with a tie-breaker for each possible linear order over the candidates. </span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        profile (Profile): An anonymous profile of linear orders on a set of candidates</span>
<span class="sd">        curr_cands (List[int], optional): If set, then find the winners for the profile restricted to the candidates in ``curr_cands``</span>

<span class="sd">    Returns: </span>
<span class="sd">        A sorted list of candidates</span>

<span class="sd">    .. warning:: </span>
<span class="sd">        This will take a long time on profiles with many candidates. </span>

<span class="sd">    :Example: </span>

<span class="sd">    .. exec_code:: </span>

<span class="sd">        from pref_voting.profiles import Profile</span>
<span class="sd">        from pref_voting.iterative_methods import coombs, coombs_tb, coombs_put</span>
<span class="sd">        </span>
<span class="sd">        prof = Profile([[2, 0, 1], [1, 0, 2], [0, 1, 2]], [2, 1, 1])</span>

<span class="sd">        prof.display()</span>
<span class="sd">        print(&quot;no tiebreaker&quot;)</span>
<span class="sd">        coombs.display(prof)</span>
<span class="sd">        print(&quot;tie_breaker = [0, 1, 2]&quot;)</span>
<span class="sd">        coombs_tb.display(prof, tie_breaker=[0, 1, 2]) </span>
<span class="sd">        print(&quot;tie_breaker = [0, 2, 1]&quot;)</span>
<span class="sd">        coombs_tb.display(prof, tie_breaker=[0, 2, 1])</span>
<span class="sd">        print(&quot;tie_breaker = [1, 0, 2]&quot;)</span>
<span class="sd">        coombs_tb.display(prof, tie_breaker=[1, 0, 2])</span>
<span class="sd">        print(&quot;tie_breaker = [1, 2, 0]&quot;)</span>
<span class="sd">        coombs_tb.display(prof, tie_breaker=[1, 2, 0])</span>
<span class="sd">        print(&quot;tie_breaker = [2, 0, 1]&quot;)</span>
<span class="sd">        coombs_tb.display(prof, tie_breaker=[2, 0, 1])</span>
<span class="sd">        print(&quot;tie_breaker = [2, 1, 0]&quot;)</span>
<span class="sd">        coombs_tb.display(prof, tie_breaker=[2, 1, 0])</span>
<span class="sd">        print()</span>
<span class="sd">        coombs_put.display(prof)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">candidates</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">curr_cands</span>

    <span class="n">strict_maj_size</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">strict_maj_size</span><span class="p">()</span>
    
    <span class="n">rs</span><span class="p">,</span> <span class="n">rcounts</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">rankings_counts</span> <span class="c1"># get all the ranking data</span>
    
    <span class="n">winners</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> 
               <span class="k">if</span> <span class="n">_num_rank_first</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="n">rcounts</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">c</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">strict_maj_size</span><span class="p">]</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">winners</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># run Coombs with tie-breaker for each permulation of candidates</span>
        <span class="k">for</span> <span class="n">tb</span> <span class="ow">in</span> <span class="n">permutations</span><span class="p">(</span><span class="n">candidates</span><span class="p">):</span>
            <span class="n">winners</span> <span class="o">+=</span> <span class="n">coombs_tb</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="n">curr_cands</span> <span class="o">=</span> <span class="n">curr_cands</span><span class="p">,</span> <span class="n">tie_breaker</span> <span class="o">=</span> <span class="n">tb</span><span class="p">)</span> 

    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">winners</span><span class="p">)))</span></div>

<div class="viewcode-block" id="coombs_with_explanation"><a class="viewcode-back" href="../../iterative_methods.html#pref_voting.iterative_methods.coombs_with_explanation">[docs]</a><span class="k">def</span> <span class="nf">coombs_with_explanation</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="n">curr_cands</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Coombs with an explanation. In addition to the winner(s), return the order in which the candidates are eliminated as a list of lists.    </span>

<span class="sd">    Args:</span>
<span class="sd">        profile (Profile): An anonymous profile of linear orders on a set of candidates</span>
<span class="sd">        curr_cands (List[int], optional): If set, then find the winners for the profile restricted to the candidates in ``curr_cands``</span>

<span class="sd">    Returns: </span>
<span class="sd">        A sorted list of candidates</span>

<span class="sd">        A list describing the order in which candidates are eliminated</span>

<span class="sd">    .. exec_code:: </span>

<span class="sd">        from pref_voting.profiles import Profile</span>
<span class="sd">        from pref_voting.iterative_methods import coombs, coombs_with_explanation</span>


<span class="sd">        prof = Profile([[2, 1, 0], [0, 2, 1], [1, 2, 0]], [1, 2, 2])</span>
<span class="sd">        prof.display()</span>
<span class="sd">        coombs.display(prof)</span>
<span class="sd">        ws, exp = coombs_with_explanation(prof)</span>
<span class="sd">        print(f&quot;winning set: {ws}&quot;)</span>
<span class="sd">        print(f&quot;order of elimination: {exp}&quot;)</span>

<span class="sd">        prof = Profile([[1, 0, 3, 2], [2, 3, 1, 0], [2, 0, 3, 1], [1, 2, 3, 0]], [1, 1, 1, 1])</span>
<span class="sd">        prof.display()</span>
<span class="sd">        coombs.display(prof)</span>
<span class="sd">        ws, exp = coombs_with_explanation(prof)</span>
<span class="sd">        print(f&quot;winning set: {ws}&quot;)</span>
<span class="sd">        print(f&quot;order of elimination: {exp}&quot;)</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">num_cands</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">num_cands</span> 
    
    <span class="n">candidates</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">curr_cands</span>
    <span class="n">cands_to_ignore</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">curr_cands</span><span class="p">])</span>

    <span class="n">strict_maj_size</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">strict_maj_size</span><span class="p">()</span>
    
    <span class="n">rs</span><span class="p">,</span> <span class="n">rcounts</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">rankings_counts</span> <span class="c1"># get all the ranking data</span>
    
    <span class="n">winners</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> 
               <span class="k">if</span> <span class="n">_num_rank_first</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="n">rcounts</span><span class="p">,</span> <span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">strict_maj_size</span><span class="p">]</span>

    <span class="n">elims_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">winners</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        
        <span class="n">last_place_scores</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="n">_num_rank_last</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="n">rcounts</span><span class="p">,</span> <span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> 
                             <span class="k">if</span> <span class="ow">not</span> <span class="n">isin</span><span class="p">(</span><span class="n">cands_to_ignore</span><span class="p">,</span><span class="n">c</span><span class="p">)}</span>  
        <span class="n">max_last_place_score</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">last_place_scores</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">greatest_last_place_votes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">last_place_scores</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> 
                                              <span class="k">if</span>  <span class="n">last_place_scores</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">==</span> <span class="n">max_last_place_score</span><span class="p">])</span>

        <span class="n">elims_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">greatest_last_place_votes</span><span class="p">))</span>
        <span class="c1"># remove candidates ranked last by the greatest number of voters</span>
        <span class="n">cands_to_ignore</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">greatest_last_place_votes</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cands_to_ignore</span><span class="p">)</span> <span class="o">==</span> <span class="n">num_cands</span><span class="p">:</span>
            <span class="n">winners</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">greatest_last_place_votes</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">winners</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> 
                       <span class="k">if</span> <span class="ow">not</span> <span class="n">isin</span><span class="p">(</span><span class="n">cands_to_ignore</span><span class="p">,</span><span class="n">c</span><span class="p">)</span> <span class="ow">and</span> <span class="n">_num_rank_first</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="n">rcounts</span><span class="p">,</span> <span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">strict_maj_size</span><span class="p">]</span>

    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">winners</span><span class="p">),</span> <span class="n">elims_list</span></div>

<div class="viewcode-block" id="baldwin"><a class="viewcode-back" href="../../iterative_methods.html#pref_voting.iterative_methods.baldwin">[docs]</a><span class="nd">@vm</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Baldwin&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">baldwin</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="n">curr_cands</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Iteratively remove all candidates with the lowest Borda score until a single candidate remains.  If, at any stage, all  candidates have the same Borda score,  then all (remaining) candidates are winners.</span>

<span class="sd">    .. note:: </span>
<span class="sd">        Baldwin is a Condorcet consistent voting method means that if a Condorcet winner exists, then Baldwin will elect the Condorcet winner. </span>

<span class="sd">    Args:</span>
<span class="sd">        profile (Profile): An anonymous profile of linear orders on a set of candidates</span>
<span class="sd">        curr_cands (List[int], optional): If set, then find the winners for the profile restricted to the candidates in ``curr_cands``</span>

<span class="sd">    Returns: </span>
<span class="sd">        A sorted list of candidates</span>

<span class="sd">    .. seealso::</span>

<span class="sd">        :func:`pref_voting.iterative_methods.baldwin_with_tb`, :func:`pref_voting.iterative_methods.baldwin`, :func:`pref_voting.iterative_methods.baldwin_with_explanation`</span>
<span class="sd">   </span>
<span class="sd">    :Example: </span>

<span class="sd">    .. exec_code:: </span>

<span class="sd">        from pref_voting.profiles import Profile</span>
<span class="sd">        from pref_voting.iterative_methods import baldwin</span>
<span class="sd">        </span>
<span class="sd">        prof = Profile([[1, 0, 2, 3], [3, 1, 0, 2], [2, 0, 3, 1]], [2, 1, 1])</span>

<span class="sd">        prof.display()</span>
<span class="sd">        baldwin.display(prof)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">all_num_cands</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">num_cands</span>   
    <span class="n">candidates</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">curr_cands</span>
        
    <span class="n">rcounts</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">_rcounts</span> <span class="c1"># get all the ranking data</span>
    <span class="n">rankings</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">_rankings</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">_find_updated_profile</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">_rankings</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">curr_cands</span><span class="p">]),</span> <span class="n">all_num_cands</span><span class="p">)</span>
    
    <span class="n">cands_to_ignore</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">curr_cands</span><span class="p">])</span>

    <span class="n">borda_scores</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="n">_borda_score</span><span class="p">(</span><span class="n">rankings</span><span class="p">,</span> <span class="n">rcounts</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">),</span> <span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">}</span>

    <span class="n">min_borda_score</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">borda_scores</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
    
    <span class="n">last_place_borda_scores</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> 
                               <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">borda_scores</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">borda_scores</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">==</span> <span class="n">min_borda_score</span><span class="p">]</span>
      
    <span class="n">cands_to_ignore</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">last_place_borda_scores</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    
    <span class="n">winners</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">cands_to_ignore</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span>  <span class="n">all_num_cands</span><span class="p">:</span> <span class="c1"># all candidates have lowest Borda score</span>
        <span class="n">winners</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">last_place_borda_scores</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> <span class="c1"># remove the candidates with lowest Borda score</span>
        <span class="n">num_cands</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span>
        <span class="n">updated_rankings</span> <span class="o">=</span> <span class="n">_find_updated_profile</span><span class="p">(</span><span class="n">rankings</span><span class="p">,</span> <span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">num_cands</span><span class="p">)</span>
        
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">winners</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">borda_scores</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="n">_borda_score</span><span class="p">(</span><span class="n">updated_rankings</span><span class="p">,</span> <span class="n">rcounts</span><span class="p">,</span> <span class="n">num_cands</span> <span class="o">-</span> <span class="n">cands_to_ignore</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">isin</span><span class="p">(</span><span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">c</span><span class="p">)}</span>
                
        <span class="n">min_borda_score</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">borda_scores</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">last_place_borda_scores</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">borda_scores</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">borda_scores</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">==</span> <span class="n">min_borda_score</span><span class="p">]</span>
        
        <span class="n">cands_to_ignore</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">last_place_borda_scores</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                
        <span class="k">if</span> <span class="n">cands_to_ignore</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">all_num_cands</span><span class="p">:</span> <span class="c1"># removed all remaining candidates</span>
            <span class="n">winners</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">last_place_borda_scores</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">num_cands</span> <span class="o">-</span> <span class="n">cands_to_ignore</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span>  <span class="mi">1</span><span class="p">:</span> <span class="c1"># only one candidate remains</span>
            <span class="n">winners</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cands_to_ignore</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">updated_rankings</span> <span class="o">=</span> <span class="n">_find_updated_profile</span><span class="p">(</span><span class="n">rankings</span><span class="p">,</span> <span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">num_cands</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">winners</span><span class="p">)</span></div>

<div class="viewcode-block" id="baldwin_tb"><a class="viewcode-back" href="../../iterative_methods.html#pref_voting.iterative_methods.baldwin_tb">[docs]</a><span class="nd">@vm</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Baldwin TB&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">baldwin_tb</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="n">curr_cands</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">tie_breaker</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Baldwin with a fixed tie-breaking rule: The tie-breaking rule is any linear order (i.e., list) of the candidates.  The default rule is to order the candidates as follows: 0,....,num_cands-1.</span>

<span class="sd">    Args:</span>
<span class="sd">        profile (Profile): An anonymous profile of linear orders on a set of candidates</span>
<span class="sd">        curr_cands (List[int], optional): If set, then find the winners for the profile restricted to the candidates in ``curr_cands``</span>
<span class="sd">        tie_breaker (List[int]): A list of the candidates in the profile to be used as a tiebreaker.</span>

<span class="sd">    Returns: </span>

<span class="sd">        A sorted list of candidates</span>

<span class="sd">    :Example: </span>

<span class="sd">    .. exec_code:: </span>

<span class="sd">        from pref_voting.profiles import Profile</span>
<span class="sd">        from pref_voting.iterative_methods import baldwin, baldwin_tb</span>
<span class="sd">        </span>
<span class="sd">        prof = Profile([[0, 2, 1, 3], [1, 3, 0, 2], [2, 3, 0, 1]], [1, 1, 1])</span>
<span class="sd">        prof.display()</span>
<span class="sd">        print(&quot;no tiebreaker&quot;)</span>
<span class="sd">        baldwin.display(prof)</span>
<span class="sd">        print(&quot;tie_breaker = [0, 1, 2, 3]&quot;)</span>
<span class="sd">        baldwin_tb.display(prof) </span>
<span class="sd">        print(&quot;tie_breaker = [2, 1, 0, 3]&quot;)</span>
<span class="sd">        baldwin_tb.display(prof, tie_breaker=[2, 1, 0, 3])</span>

<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># the tie_breaker is any linear order (i.e., list) of the candidates</span>
    <span class="n">tb</span> <span class="o">=</span> <span class="n">tie_breaker</span> <span class="k">if</span> <span class="n">tie_breaker</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">num_cands</span><span class="p">))</span>

    <span class="n">all_num_cands</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">num_cands</span>   
    <span class="n">candidates</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">curr_cands</span>
        
    <span class="n">rcounts</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">_rcounts</span> <span class="c1"># get all the ranking data</span>
    <span class="n">rankings</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">_rankings</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">_find_updated_profile</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">_rankings</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">curr_cands</span><span class="p">]),</span> <span class="n">all_num_cands</span><span class="p">)</span>
    
    <span class="n">cands_to_ignore</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">curr_cands</span><span class="p">])</span>

    <span class="n">borda_scores</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="n">_borda_score</span><span class="p">(</span><span class="n">rankings</span><span class="p">,</span> <span class="n">rcounts</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">),</span> <span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">}</span>

    <span class="n">min_borda_score</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">borda_scores</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
    
    <span class="n">last_place_borda_scores</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> 
                               <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">borda_scores</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">borda_scores</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">==</span> <span class="n">min_borda_score</span><span class="p">]</span>
      
    <span class="n">cand_to_remove</span> <span class="o">=</span> <span class="n">last_place_borda_scores</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">last_place_borda_scores</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span> 
        <span class="k">if</span> <span class="n">tb</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tb</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">cand_to_remove</span><span class="p">):</span>
            <span class="n">cand_to_remove</span> <span class="o">=</span> <span class="n">c</span>
    <span class="n">cands_to_ignore</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">cand_to_remove</span><span class="p">])),</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    
    <span class="n">winners</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">cands_to_ignore</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span>  <span class="n">all_num_cands</span><span class="p">:</span> <span class="c1"># all candidates have lowest Borda score</span>
        <span class="n">winners</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">last_place_borda_scores</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> <span class="c1"># remove the candidates with lowest Borda score</span>
        <span class="n">num_cands</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span>
        <span class="n">updated_rankings</span> <span class="o">=</span> <span class="n">_find_updated_profile</span><span class="p">(</span><span class="n">rankings</span><span class="p">,</span> <span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">num_cands</span><span class="p">)</span>
        
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">winners</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">borda_scores</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="n">_borda_score</span><span class="p">(</span><span class="n">updated_rankings</span><span class="p">,</span> <span class="n">rcounts</span><span class="p">,</span> <span class="n">num_cands</span> <span class="o">-</span> <span class="n">cands_to_ignore</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">c</span><span class="p">)</span> 
                        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">isin</span><span class="p">(</span><span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">c</span><span class="p">)}</span>
                
        <span class="n">min_borda_score</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">borda_scores</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">last_place_borda_scores</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">borda_scores</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">borda_scores</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">==</span> <span class="n">min_borda_score</span><span class="p">]</span>
        
        <span class="c1"># select the candidate to remove using the tie-breaking rule (a linear order over the candidates)</span>
        <span class="n">cand_to_remove</span> <span class="o">=</span> <span class="n">last_place_borda_scores</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">last_place_borda_scores</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span> 
            <span class="k">if</span> <span class="n">tb</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tb</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">cand_to_remove</span><span class="p">):</span>
                <span class="n">cand_to_remove</span> <span class="o">=</span> <span class="n">c</span>
        
        <span class="n">cands_to_ignore</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">cand_to_remove</span><span class="p">])),</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                
        <span class="k">if</span> <span class="n">cands_to_ignore</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">all_num_cands</span><span class="p">:</span> <span class="c1"># removed all remaining candidates</span>
            <span class="n">winners</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">last_place_borda_scores</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">num_cands</span> <span class="o">-</span> <span class="n">cands_to_ignore</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span>  <span class="mi">1</span><span class="p">:</span> <span class="c1"># only one candidate remains</span>
            <span class="n">winners</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cands_to_ignore</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">updated_rankings</span> <span class="o">=</span> <span class="n">_find_updated_profile</span><span class="p">(</span><span class="n">rankings</span><span class="p">,</span> <span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">num_cands</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">winners</span><span class="p">)</span></div>

<div class="viewcode-block" id="baldwin_put"><a class="viewcode-back" href="../../iterative_methods.html#pref_voting.iterative_methods.baldwin_put">[docs]</a><span class="nd">@vm</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Baldwin PUT&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">baldwin_put</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="n">curr_cands</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Baldwin with parallel universe tie-breaking (PUT).  Apply the Baldwin method with a tie-breaker for each possible linear order over the candidates. </span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        profile (Profile): An anonymous profile of linear orders on a set of candidates</span>
<span class="sd">        curr_cands (List[int], optional): If set, then find the winners for the profile restricted to the candidates in ``curr_cands``</span>

<span class="sd">    Returns: </span>
<span class="sd">        A sorted list of candidates</span>

<span class="sd">    .. warning:: </span>
<span class="sd">        This will take a long time on profiles with many candidates. </span>

<span class="sd">    :Example: </span>

<span class="sd">    .. exec_code:: </span>

<span class="sd">        from pref_voting.profiles import Profile</span>
<span class="sd">        from pref_voting.iterative_methods import baldwin, baldwin_tb, baldwin_put</span>
<span class="sd">        </span>
<span class="sd">        prof = Profile([[1, 2, 0], [0, 1, 2], [2, 0, 1]], [1, 3, 2])</span>

<span class="sd">        prof.display()</span>
<span class="sd">        print(&quot;no tiebreaker&quot;)</span>
<span class="sd">        baldwin.display(prof)</span>
<span class="sd">        print(&quot;tie_breaker = [0, 1, 2]&quot;)</span>
<span class="sd">        baldwin_tb.display(prof, tie_breaker=[0, 1, 2]) </span>
<span class="sd">        print(&quot;tie_breaker = [0, 2, 1]&quot;)</span>
<span class="sd">        baldwin_tb.display(prof, tie_breaker=[0, 2, 1])</span>
<span class="sd">        print(&quot;tie_breaker = [1, 0, 2]&quot;)</span>
<span class="sd">        baldwin_tb.display(prof, tie_breaker=[1, 0, 2])</span>
<span class="sd">        print(&quot;tie_breaker = [1, 2, 0]&quot;)</span>
<span class="sd">        baldwin_tb.display(prof, tie_breaker=[1, 2, 0])</span>
<span class="sd">        print(&quot;tie_breaker = [2, 0, 1]&quot;)</span>
<span class="sd">        baldwin_tb.display(prof, tie_breaker=[2, 0, 1])</span>
<span class="sd">        print(&quot;tie_breaker = [2, 1, 0]&quot;)</span>
<span class="sd">        baldwin_tb.display(prof, tie_breaker=[2, 1, 0])</span>
<span class="sd">        print()</span>
<span class="sd">        baldwin_put.display(prof)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">candidates</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">curr_cands</span>    
    <span class="n">cw</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">condorcet_winner</span><span class="p">(</span><span class="n">curr_cands</span><span class="o">=</span><span class="n">curr_cands</span><span class="p">)</span>
    
    <span class="n">winners</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span> <span class="k">if</span> <span class="n">cw</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[</span><span class="n">cw</span><span class="p">]</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">winners</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># run Coombs with tie-breaker for each permulation of candidates</span>
        <span class="k">for</span> <span class="n">tb</span> <span class="ow">in</span> <span class="n">permutations</span><span class="p">(</span><span class="n">candidates</span><span class="p">):</span>
            <span class="n">winners</span> <span class="o">+=</span> <span class="n">baldwin_tb</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="n">curr_cands</span> <span class="o">=</span> <span class="n">curr_cands</span><span class="p">,</span> <span class="n">tie_breaker</span> <span class="o">=</span> <span class="n">tb</span><span class="p">)</span> 

    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">winners</span><span class="p">)))</span></div>


<div class="viewcode-block" id="baldwin_with_explanation"><a class="viewcode-back" href="../../iterative_methods.html#pref_voting.iterative_methods.baldwin_with_explanation">[docs]</a><span class="k">def</span> <span class="nf">baldwin_with_explanation</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="n">curr_cands</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Baldwin with an explanation. In addition to the winner(s), return the order in which the candidates are eliminated as a list of dictionaries specifying the Borda scores in the profile resctricted to the candidates that have not been eliminated.    </span>

<span class="sd">    Args:</span>
<span class="sd">        profile (Profile): An anonymous profile of linear orders on a set of candidates</span>
<span class="sd">        curr_cands (List[int], optional): If set, then find the winners for the profile restricted to the candidates in ``curr_cands``</span>

<span class="sd">    Returns: </span>
<span class="sd">        A sorted list of candidates</span>

<span class="sd">        A list describing for each round, the candidates that are eliminated and the Borda scores of the remaining candidates (in the profile restricted to candidates that have not been eliminated)</span>

<span class="sd">    .. exec_code:: </span>

<span class="sd">        from pref_voting.profiles import Profile</span>
<span class="sd">        from pref_voting.iterative_methods import baldwin, baldwin_with_explanation</span>

<span class="sd">        prof = Profile([[2, 1, 0], [0, 2, 1], [1, 2, 0]], [1, 2, 2])</span>
<span class="sd">        prof.display()</span>
<span class="sd">        baldwin.display(prof)</span>
<span class="sd">        ws, exp = baldwin_with_explanation(prof)</span>
<span class="sd">        print(f&quot;winning set: {ws}&quot;)</span>
<span class="sd">        print(f&quot;order of elimination: {exp}&quot;)</span>

<span class="sd">        prof = Profile([[1, 0, 3, 2], [2, 3, 1, 0], [2, 0, 3, 1], [1, 2, 3, 0]], [1, 1, 1, 1])</span>
<span class="sd">        prof.display()</span>
<span class="sd">        baldwin.display(prof)</span>
<span class="sd">        ws, exp = baldwin_with_explanation(prof)</span>
<span class="sd">        print(f&quot;winning set: {ws}&quot;)</span>
<span class="sd">        print(f&quot;order of elimination: {exp}&quot;)</span>


<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">all_num_cands</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">num_cands</span>   
    <span class="n">candidates</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">curr_cands</span>
    <span class="n">elims_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        
    <span class="n">rcounts</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">_rcounts</span> <span class="c1"># get all the ranking data</span>
    <span class="n">rankings</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">_rankings</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">_find_updated_profile</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">_rankings</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">curr_cands</span><span class="p">]),</span> <span class="n">all_num_cands</span><span class="p">)</span>
    
    <span class="n">cands_to_ignore</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">curr_cands</span><span class="p">])</span>

    <span class="n">borda_scores</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="n">_borda_score</span><span class="p">(</span><span class="n">rankings</span><span class="p">,</span> <span class="n">rcounts</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">),</span> <span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">}</span>

    <span class="n">min_borda_score</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">borda_scores</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
    
    <span class="n">last_place_borda_scores</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> 
                               <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">borda_scores</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">borda_scores</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">==</span> <span class="n">min_borda_score</span><span class="p">]</span>
    <span class="n">elims_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">last_place_borda_scores</span><span class="p">,</span> <span class="n">borda_scores</span><span class="p">])</span>
    <span class="n">cands_to_ignore</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">last_place_borda_scores</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    
    <span class="n">winners</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">cands_to_ignore</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span>  <span class="n">all_num_cands</span><span class="p">:</span> <span class="c1"># all candidates have lowest Borda score</span>
        <span class="n">winners</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">last_place_borda_scores</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> <span class="c1"># remove the candidates with lowest Borda score</span>
        <span class="n">num_cands</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span>
        <span class="n">updated_rankings</span> <span class="o">=</span> <span class="n">_find_updated_profile</span><span class="p">(</span><span class="n">rankings</span><span class="p">,</span> <span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">num_cands</span><span class="p">)</span>
        
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">winners</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">borda_scores</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="n">_borda_score</span><span class="p">(</span><span class="n">updated_rankings</span><span class="p">,</span> <span class="n">rcounts</span><span class="p">,</span> <span class="n">num_cands</span> <span class="o">-</span> <span class="n">cands_to_ignore</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">c</span><span class="p">)</span> 
                        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">isin</span><span class="p">(</span><span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">c</span><span class="p">)}</span>
                
        <span class="n">min_borda_score</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">borda_scores</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">last_place_borda_scores</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">borda_scores</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">borda_scores</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">==</span> <span class="n">min_borda_score</span><span class="p">]</span>
        <span class="n">elims_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">last_place_borda_scores</span><span class="p">,</span> <span class="n">borda_scores</span><span class="p">])</span>
        
        <span class="n">cands_to_ignore</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">last_place_borda_scores</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                
        <span class="k">if</span> <span class="n">cands_to_ignore</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">all_num_cands</span><span class="p">:</span> <span class="c1"># removed all remaining candidates</span>
            <span class="n">winners</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">last_place_borda_scores</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">num_cands</span> <span class="o">-</span> <span class="n">cands_to_ignore</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span>  <span class="mi">1</span><span class="p">:</span> <span class="c1"># only one candidate remains</span>
            <span class="n">winners</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cands_to_ignore</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">updated_rankings</span> <span class="o">=</span> <span class="n">_find_updated_profile</span><span class="p">(</span><span class="n">rankings</span><span class="p">,</span> <span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">num_cands</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">winners</span><span class="p">),</span> <span class="n">elims_list</span></div>


<div class="viewcode-block" id="strict_nanson"><a class="viewcode-back" href="../../iterative_methods.html#pref_voting.iterative_methods.strict_nanson">[docs]</a><span class="nd">@vm</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Strict Nanson&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">strict_nanson</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="n">curr_cands</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Iteratively remove all candidates with the  Borda score strictly below the average Borda score until one candidate remains.  If, at any stage, all  candidates have the same Borda score, then all (remaining) candidates are winners.</span>

<span class="sd">    .. note:: </span>
<span class="sd">        </span>
<span class="sd">        Strict Nanson is a Condorcet consistent voting method means that if a Condorcet winner exists, then Strict Nanson will elect the Condorcet winner. </span>

<span class="sd">    Args:</span>
<span class="sd">        profile (Profile): An anonymous profile of linear orders on a set of candidates</span>
<span class="sd">        curr_cands (List[int], optional): If set, then find the winners for the profile restricted to the candidates in ``curr_cands``</span>

<span class="sd">    Returns: </span>
<span class="sd">        A sorted list of candidates</span>

<span class="sd">    .. seealso::</span>

<span class="sd">        :func:`pref_voting.iterative_methods.strict_nanson_with_explanation`, :func:`pref_voting.iterative_methods.weak_nanson`</span>
<span class="sd">   </span>
<span class="sd">    :Example: </span>

<span class="sd">    .. exec_code:: </span>

<span class="sd">        from pref_voting.profiles import Profile</span>
<span class="sd">        from pref_voting.iterative_methods import strict_nanson</span>
<span class="sd">        </span>
<span class="sd">        prof = Profile([[2, 1, 0, 3], [0, 2, 1, 3], [1, 3, 0, 2], [0, 3, 2, 1]], [2, 1, 1, 1])</span>

<span class="sd">        prof.display()</span>
<span class="sd">        strict_nanson.display(prof)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">all_num_cands</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">num_cands</span>   
    <span class="n">candidates</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">curr_cands</span>
        
    <span class="n">rcounts</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">_rcounts</span> <span class="c1"># get all the ranking data</span>
    <span class="n">rankings</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">_rankings</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">_find_updated_profile</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">_rankings</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">curr_cands</span><span class="p">]),</span> <span class="n">all_num_cands</span><span class="p">)</span>
    <span class="n">cands_to_ignore</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">borda_scores</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="n">_borda_score</span><span class="p">(</span><span class="n">rankings</span><span class="p">,</span> <span class="n">rcounts</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">),</span> <span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">}</span>
    
    <span class="n">avg_borda_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">borda_scores</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
    <span class="n">below_borda_avg_candidates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">borda_scores</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">borda_scores</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">avg_borda_score</span><span class="p">])</span>
    
    <span class="n">cands_to_ignore</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">below_borda_avg_candidates</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">winners</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">cands_to_ignore</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">all_num_cands</span><span class="p">:</span>  <span class="c1"># all candidates have same Borda score</span>
        <span class="n">winners</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="n">num_cands</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span>
        <span class="n">updated_rankings</span> <span class="o">=</span> <span class="n">_find_updated_profile</span><span class="p">(</span><span class="n">rankings</span><span class="p">,</span> <span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">num_cands</span><span class="p">)</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">winners</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> 
        
        <span class="n">borda_scores</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="n">_borda_score</span><span class="p">(</span><span class="n">updated_rankings</span><span class="p">,</span> <span class="n">rcounts</span><span class="p">,</span> <span class="n">num_cands</span> <span class="o">-</span> <span class="n">cands_to_ignore</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">c</span><span class="p">)</span> 
                        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">isin</span><span class="p">(</span><span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">c</span><span class="p">)}</span>
        
        <span class="n">avg_borda_scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">borda_scores</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
    
        <span class="n">below_borda_avg_candidates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">borda_scores</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> 
                                               <span class="k">if</span> <span class="n">borda_scores</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">avg_borda_scores</span><span class="p">])</span>
        
        <span class="n">cands_to_ignore</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">below_borda_avg_candidates</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                
        <span class="k">if</span> <span class="p">(</span><span class="n">below_borda_avg_candidates</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">((</span><span class="n">all_num_cands</span> <span class="o">-</span> <span class="n">cands_to_ignore</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">winners</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cands_to_ignore</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">updated_rankings</span> <span class="o">=</span> <span class="n">_find_updated_profile</span><span class="p">(</span><span class="n">rankings</span><span class="p">,</span> <span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">num_cands</span><span class="p">)</span>
            
    <span class="k">return</span> <span class="n">winners</span></div>


<div class="viewcode-block" id="strict_nanson_with_explanation"><a class="viewcode-back" href="../../iterative_methods.html#pref_voting.iterative_methods.strict_nanson_with_explanation">[docs]</a><span class="k">def</span> <span class="nf">strict_nanson_with_explanation</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="n">curr_cands</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Strict Nanson with an explanation. In addition to the winner(s), return the order in which the candidates are eliminated as a list of dictionaries specifying the Borda scores in the profile resctricted to the candidates that have not been eliminated and the average Borda score.    </span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        profile (Profile): An anonymous profile of linear orders on a set of candidates</span>
<span class="sd">        curr_cands (List[int], optional): If set, then find the winners for the profile restricted to the candidates in ``curr_cands``</span>

<span class="sd">    Returns: </span>
<span class="sd">        A sorted list of candidates</span>

<span class="sd">        A list describing for each round, the candidates that are eliminated and the Borda scores of the remaining candidates (in the profile restricted to candidates that have not been eliminated)</span>
<span class="sd">    :Example: </span>

<span class="sd">    .. exec_code:: </span>

<span class="sd">        from pref_voting.profiles import Profile</span>
<span class="sd">        from pref_voting.iterative_methods import strict_nanson_with_explanation</span>
<span class="sd">        </span>
<span class="sd">        prof = Profile([[2, 1, 0, 3], [0, 2, 1, 3], [1, 3, 0, 2], [0, 3, 2, 1]], [2, 1, 1, 1])</span>

<span class="sd">        prof.display()</span>
<span class="sd">        print(strict_nanson_with_explanation(prof))</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">all_num_cands</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">num_cands</span>   
    <span class="n">candidates</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">curr_cands</span>
    
    <span class="n">rcounts</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">_rcounts</span> <span class="c1"># get all the ranking data</span>
    <span class="n">rankings</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">_rankings</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">_find_updated_profile</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">_rankings</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">curr_cands</span><span class="p">]),</span> <span class="n">all_num_cands</span><span class="p">)</span>
    <span class="n">cands_to_ignore</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">elim_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    
    <span class="n">borda_scores</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="n">_borda_score</span><span class="p">(</span><span class="n">rankings</span><span class="p">,</span> <span class="n">rcounts</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">),</span> <span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">}</span>
    
    <span class="n">avg_borda_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">borda_scores</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
    <span class="n">below_borda_avg_candidates</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">borda_scores</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">borda_scores</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">avg_borda_score</span><span class="p">]</span>
    
    <span class="n">cands_to_ignore</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">below_borda_avg_candidates</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">winners</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">cands_to_ignore</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">all_num_cands</span><span class="p">:</span>  <span class="c1"># all candidates have same Borda score</span>
        <span class="n">elim_list</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;avg_borda_score&quot;</span><span class="p">:</span> <span class="n">avg_borda_score</span><span class="p">,</span> 
                          <span class="s2">&quot;elim_cands&quot;</span><span class="p">:</span> <span class="n">below_borda_avg_candidates</span><span class="p">,</span>
                          <span class="s2">&quot;borda_scores&quot;</span><span class="p">:</span> <span class="n">borda_scores</span><span class="p">})</span>
        <span class="n">winners</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="n">num_cands</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span>
        <span class="n">elim_list</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;avg_borda_score&quot;</span><span class="p">:</span> <span class="n">avg_borda_score</span><span class="p">,</span> 
                          <span class="s2">&quot;elim_cands&quot;</span><span class="p">:</span> <span class="n">below_borda_avg_candidates</span><span class="p">,</span>
                          <span class="s2">&quot;borda_scores&quot;</span><span class="p">:</span> <span class="n">borda_scores</span><span class="p">})</span>
        <span class="n">updated_rankings</span> <span class="o">=</span> <span class="n">_find_updated_profile</span><span class="p">(</span><span class="n">rankings</span><span class="p">,</span> <span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">num_cands</span><span class="p">)</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">winners</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> 
        
        <span class="n">borda_scores</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="n">_borda_score</span><span class="p">(</span><span class="n">updated_rankings</span><span class="p">,</span> <span class="n">rcounts</span><span class="p">,</span> <span class="n">num_cands</span> <span class="o">-</span> <span class="n">cands_to_ignore</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">c</span><span class="p">)</span> 
                        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">isin</span><span class="p">(</span><span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">c</span><span class="p">)}</span>
        
        <span class="n">avg_borda_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">borda_scores</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
    
        <span class="n">below_borda_avg_candidates</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">borda_scores</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> 
                                      <span class="k">if</span> <span class="n">borda_scores</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">avg_borda_score</span><span class="p">]</span>
        
        <span class="n">cands_to_ignore</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">below_borda_avg_candidates</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">elim_list</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;avg_borda_score&quot;</span><span class="p">:</span> <span class="n">avg_borda_score</span><span class="p">,</span> 
                          <span class="s2">&quot;elim_cands&quot;</span><span class="p">:</span> <span class="n">below_borda_avg_candidates</span><span class="p">,</span>
                          <span class="s2">&quot;borda_scores&quot;</span><span class="p">:</span> <span class="n">borda_scores</span><span class="p">})</span>
                
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">below_borda_avg_candidates</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">((</span><span class="n">all_num_cands</span> <span class="o">-</span> <span class="n">cands_to_ignore</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">winners</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cands_to_ignore</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">updated_rankings</span> <span class="o">=</span> <span class="n">_find_updated_profile</span><span class="p">(</span><span class="n">rankings</span><span class="p">,</span> <span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">num_cands</span><span class="p">)</span>
            
    <span class="k">return</span> <span class="n">winners</span><span class="p">,</span> <span class="n">elim_list</span></div>


<div class="viewcode-block" id="weak_nanson"><a class="viewcode-back" href="../../iterative_methods.html#pref_voting.iterative_methods.weak_nanson">[docs]</a><span class="nd">@vm</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Weak Nanson&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">weak_nanson</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="n">curr_cands</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Iteratively remove all candidates with Borda score less than or equal the average Borda score until one candidate remains.  If, at any stage, all  candidates have the same Borda score, then all (remaining) candidates are winners.</span>

<span class="sd">    .. note:: </span>

<span class="sd">        Weak Nanson is a Condorcet consistent voting method means that if a Condorcet winner exists, then Weak Nanson will elect the Condorcet winner. </span>

<span class="sd">    Args:</span>
<span class="sd">        profile (Profile): An anonymous profile of linear orders on a set of candidates</span>
<span class="sd">        curr_cands (List[int], optional): If set, then find the winners for the profile restricted to the candidates in ``curr_cands``</span>

<span class="sd">    Returns: </span>
<span class="sd">        A sorted list of candidates</span>

<span class="sd">    .. seealso::</span>

<span class="sd">        :func:`pref_voting.iterative_methods.weak_nanson_with_explanation`, :func:`pref_voting.iterative_methods.strict_nanson`</span>
<span class="sd">   </span>
<span class="sd">    :Example: </span>

<span class="sd">    .. exec_code:: </span>

<span class="sd">        from pref_voting.profiles import Profile</span>
<span class="sd">        from pref_voting.iterative_methods import weak_nanson</span>
<span class="sd">        </span>
<span class="sd">        prof = Profile([[2, 1, 0, 3], [0, 2, 1, 3], [1, 3, 0, 2], [0, 3, 2, 1]], [2, 1, 1, 1])</span>

<span class="sd">        prof.display()</span>
<span class="sd">        weak_nanson.display(prof)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">all_num_cands</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">num_cands</span>   
    <span class="n">candidates</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">curr_cands</span>
        
    <span class="n">rcounts</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">_rcounts</span> <span class="c1"># get all the ranking data</span>
    <span class="n">rankings</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">_rankings</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">_find_updated_profile</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">_rankings</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">curr_cands</span><span class="p">]),</span> <span class="n">all_num_cands</span><span class="p">)</span>
    
    <span class="n">cands_to_ignore</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">curr_cands</span><span class="p">])</span>

    <span class="n">borda_scores</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="n">_borda_score</span><span class="p">(</span><span class="n">rankings</span><span class="p">,</span> <span class="n">rcounts</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">),</span> <span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">}</span>

    <span class="n">avg_borda_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">borda_scores</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>

    <span class="n">below_borda_avg_candidates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">borda_scores</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">borda_scores</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">avg_borda_score</span><span class="p">])</span>
    
    <span class="n">cands_to_ignore</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">below_borda_avg_candidates</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    
    <span class="n">winners</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">cands_to_ignore</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">all_num_cands</span><span class="p">:</span>  <span class="c1"># all candidates have same Borda score</span>
        <span class="n">winners</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">all_num_cands</span> <span class="o">-</span> <span class="n">cands_to_ignore</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># one candidate remains</span>
        <span class="n">winners</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">isin</span><span class="p">(</span><span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">c</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="n">num_cands</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span>
        <span class="n">updated_rankings</span> <span class="o">=</span> <span class="n">_find_updated_profile</span><span class="p">(</span><span class="n">rankings</span><span class="p">,</span> <span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">num_cands</span><span class="p">)</span>
        
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">winners</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> 
        
        <span class="n">borda_scores</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="n">_borda_score</span><span class="p">(</span><span class="n">updated_rankings</span><span class="p">,</span> <span class="n">rcounts</span><span class="p">,</span> <span class="n">num_cands</span> <span class="o">-</span> <span class="n">cands_to_ignore</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">c</span><span class="p">)</span> 
                        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">isin</span><span class="p">(</span><span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">c</span><span class="p">)}</span>
        

        <span class="n">avg_borda_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">borda_scores</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>

        <span class="n">below_borda_avg_candidates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">borda_scores</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> 
                                               <span class="k">if</span> <span class="n">borda_scores</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">avg_borda_score</span><span class="p">])</span>
        
        <span class="n">cands_to_ignore</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">below_borda_avg_candidates</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">cands_to_ignore</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">all_num_cands</span><span class="p">:</span>  <span class="c1"># all remaining candidates have been removed</span>
            <span class="n">winners</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">below_borda_avg_candidates</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">all_num_cands</span> <span class="o">-</span> <span class="n">cands_to_ignore</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># one candidate remains</span>
            <span class="n">winners</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">isin</span><span class="p">(</span><span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">c</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">updated_rankings</span> <span class="o">=</span> <span class="n">_find_updated_profile</span><span class="p">(</span><span class="n">rankings</span><span class="p">,</span> <span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">num_cands</span><span class="p">)</span>
            
    <span class="k">return</span> <span class="n">winners</span></div>


<div class="viewcode-block" id="weak_nanson_with_explanation"><a class="viewcode-back" href="../../iterative_methods.html#pref_voting.iterative_methods.weak_nanson_with_explanation">[docs]</a><span class="k">def</span> <span class="nf">weak_nanson_with_explanation</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="n">curr_cands</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Weak Nanson with an explanation. In addition to the winner(s), return the order in which the candidates are eliminated as a list of dictionaries specifying the Borda scores in the profile resctricted to the candidates that have not been eliminated and the average Borda score.    </span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        profile (Profile): An anonymous profile of linear orders on a set of candidates</span>
<span class="sd">        curr_cands (List[int], optional): If set, then find the winners for the profile restricted to the candidates in ``curr_cands``</span>

<span class="sd">    Returns: </span>
<span class="sd">        A sorted list of candidates</span>

<span class="sd">        A list describing for each round, the candidates that are eliminated and the Borda scores of the remaining candidates (in the profile restricted to candidates that have not been eliminated)</span>
<span class="sd">    :Example: </span>

<span class="sd">    .. exec_code:: </span>

<span class="sd">        from pref_voting.profiles import Profile</span>
<span class="sd">        from pref_voting.iterative_methods import weak_nanson_with_explanation</span>
<span class="sd">        </span>
<span class="sd">        prof = Profile([[2, 1, 0, 3], [0, 2, 1, 3], [1, 3, 0, 2], [0, 3, 2, 1]], [2, 1, 1, 1])</span>

<span class="sd">        prof.display()</span>
<span class="sd">        print(weak_nanson_with_explanation(prof))</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">all_num_cands</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">num_cands</span>   
    <span class="n">candidates</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">curr_cands</span>
        
    <span class="n">rcounts</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">_rcounts</span> <span class="c1"># get all the ranking data</span>
    <span class="n">rankings</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">_rankings</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">_find_updated_profile</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">_rankings</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">curr_cands</span><span class="p">]),</span> <span class="n">all_num_cands</span><span class="p">)</span>
    <span class="n">cands_to_ignore</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">curr_cands</span><span class="p">])</span>
    <span class="n">elim_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    
    <span class="n">borda_scores</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="n">_borda_score</span><span class="p">(</span><span class="n">rankings</span><span class="p">,</span> <span class="n">rcounts</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">),</span> <span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">}</span>
    
    <span class="n">avg_borda_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">borda_scores</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
    <span class="n">below_borda_avg_candidates</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">borda_scores</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> 
                                  <span class="k">if</span> <span class="n">borda_scores</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">avg_borda_score</span><span class="p">]</span>
    
    <span class="n">cands_to_ignore</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">below_borda_avg_candidates</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">winners</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">cands_to_ignore</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">all_num_cands</span><span class="p">:</span>  <span class="c1"># all candidates have same Borda score</span>
        <span class="n">elim_list</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;avg_borda_score&quot;</span><span class="p">:</span> <span class="n">avg_borda_score</span><span class="p">,</span> 
                          <span class="s2">&quot;elim_cands&quot;</span><span class="p">:</span> <span class="n">below_borda_avg_candidates</span><span class="p">,</span>
                          <span class="s2">&quot;borda_scores&quot;</span><span class="p">:</span> <span class="n">borda_scores</span><span class="p">})</span>
        <span class="n">winners</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">all_num_cands</span> <span class="o">-</span> <span class="n">cands_to_ignore</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># one candidate remains</span>
        <span class="n">elim_list</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;avg_borda_score&quot;</span><span class="p">:</span> <span class="n">avg_borda_score</span><span class="p">,</span> 
                          <span class="s2">&quot;elim_cands&quot;</span><span class="p">:</span> <span class="n">below_borda_avg_candidates</span><span class="p">,</span>
                          <span class="s2">&quot;borda_scores&quot;</span><span class="p">:</span> <span class="n">borda_scores</span><span class="p">})</span>
        <span class="n">winners</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">isin</span><span class="p">(</span><span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">c</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="n">num_cands</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span>
        <span class="n">elim_list</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;avg_borda_score&quot;</span><span class="p">:</span> <span class="n">avg_borda_score</span><span class="p">,</span> 
                          <span class="s2">&quot;elim_cands&quot;</span><span class="p">:</span> <span class="n">below_borda_avg_candidates</span><span class="p">,</span>
                          <span class="s2">&quot;borda_scores&quot;</span><span class="p">:</span> <span class="n">borda_scores</span><span class="p">})</span>
        <span class="n">updated_rankings</span> <span class="o">=</span> <span class="n">_find_updated_profile</span><span class="p">(</span><span class="n">rankings</span><span class="p">,</span> <span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">num_cands</span><span class="p">)</span>
        

    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">winners</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> 
        
        <span class="n">borda_scores</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="n">_borda_score</span><span class="p">(</span><span class="n">updated_rankings</span><span class="p">,</span> <span class="n">rcounts</span><span class="p">,</span> <span class="n">num_cands</span> <span class="o">-</span> <span class="n">cands_to_ignore</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">c</span><span class="p">)</span> 
                        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">isin</span><span class="p">(</span><span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">c</span><span class="p">)}</span>
        
        <span class="n">avg_borda_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">borda_scores</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
    
        <span class="n">below_borda_avg_candidates</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">borda_scores</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> 
                                      <span class="k">if</span> <span class="n">borda_scores</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">avg_borda_score</span><span class="p">]</span>
        
        <span class="n">cands_to_ignore</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">below_borda_avg_candidates</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">elim_list</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;avg_borda_score&quot;</span><span class="p">:</span> <span class="n">avg_borda_score</span><span class="p">,</span> 
                          <span class="s2">&quot;elim_cands&quot;</span><span class="p">:</span> <span class="n">below_borda_avg_candidates</span><span class="p">,</span>
                          <span class="s2">&quot;borda_scores&quot;</span><span class="p">:</span> <span class="n">borda_scores</span><span class="p">})</span>
                
        <span class="k">if</span> <span class="n">cands_to_ignore</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">all_num_cands</span><span class="p">:</span>  <span class="c1"># all remaining candidates have been removed</span>
            <span class="n">winners</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">below_borda_avg_candidates</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">all_num_cands</span> <span class="o">-</span> <span class="n">cands_to_ignore</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># one candidate remains</span>
            <span class="n">winners</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">isin</span><span class="p">(</span><span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">c</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">updated_rankings</span> <span class="o">=</span> <span class="n">_find_updated_profile</span><span class="p">(</span><span class="n">rankings</span><span class="p">,</span> <span class="n">cands_to_ignore</span><span class="p">,</span> <span class="n">num_cands</span><span class="p">)</span>
            
    <span class="k">return</span> <span class="n">winners</span><span class="p">,</span> <span class="n">elim_list</span></div>


<div class="viewcode-block" id="iterated_removal_cl"><a class="viewcode-back" href="../../iterative_methods.html#pref_voting.iterative_methods.iterated_removal_cl">[docs]</a><span class="nd">@vm</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Iterated Removal Condorcet Loser&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">iterated_removal_cl</span><span class="p">(</span><span class="n">edata</span><span class="p">,</span> <span class="n">curr_cands</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Iteratively remove candidates that are Condorcet losers until there are no Condorcet losers.   A candidate :math:`c` is a **Condorcet loser** when every other candidate is majority preferred to :math:`c`. </span>

<span class="sd">    Args:</span>
<span class="sd">        edata (Profile, ProfileWithTies, MajorityGraph, MarginGraph): Any election data that has a `condorcet_loser` method. </span>
<span class="sd">        curr_cands (List[int], optional): If set, then find the winners for the profile restricted to the candidates in ``curr_cands``</span>

<span class="sd">    Returns: </span>
<span class="sd">        A sorted list of candidates</span>

<span class="sd">    .. seealso::</span>

<span class="sd">        :meth:`pref_voting.profiles.Profile.condorcet_loser`,  :meth:`pref_voting.profiles_with_ties.ProfileWithTies.condorcet_loser`, :meth:`pref_voting.weighted_majority_graphs.MajorityGraph.condorcet_loser`</span>

<span class="sd">    :Example: </span>

<span class="sd">    .. exec_code:: </span>

<span class="sd">        from pref_voting.profiles import Profile</span>
<span class="sd">        from pref_voting.profiles_with_ties import ProfileWithTies</span>
<span class="sd">        from pref_voting.iterative_methods import iterated_removal_cl</span>
<span class="sd">        </span>
<span class="sd">        prof = Profile([[2, 1, 3, 0], [2, 1, 0, 3], [3, 1, 2, 0], [1, 2, 3, 0]], [1, 1, 1, 1])</span>

<span class="sd">        prof.display()</span>
<span class="sd">        iterated_removal_cl.display(prof)</span>
<span class="sd">        iterated_removal_cl.display(prof.majority_graph())</span>
<span class="sd">        iterated_removal_cl.display(prof.margin_graph())</span>

<span class="sd">        prof2 = ProfileWithTies([{2:1, 1:1, 3:2, 0:3}, {2:1, 1:2, 0:3, 3:4}, {3:1, 1:2, 2:3, 0:4}, {1:1, 2:2, 3:3, 0:4}], [1, 1, 1, 1])</span>

<span class="sd">        prof2.display()</span>
<span class="sd">        iterated_removal_cl.display(prof2)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">condorcet_loser</span> <span class="o">=</span> <span class="n">edata</span><span class="o">.</span><span class="n">condorcet_loser</span><span class="p">(</span><span class="n">curr_cands</span> <span class="o">=</span> <span class="n">curr_cands</span><span class="p">)</span>  
    
    <span class="n">remaining_cands</span> <span class="o">=</span> <span class="n">edata</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">curr_cands</span>
    
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">remaining_cands</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span>  <span class="n">condorcet_loser</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>    
        <span class="n">remaining_cands</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">remaining_cands</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">condorcet_loser</span><span class="p">]]</span>
        <span class="n">condorcet_loser</span> <span class="o">=</span> <span class="n">edata</span><span class="o">.</span><span class="n">condorcet_loser</span><span class="p">(</span><span class="n">curr_cands</span> <span class="o">=</span> <span class="n">remaining_cands</span><span class="p">)</span>
            
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">remaining_cands</span><span class="p">)</span></div>


<div class="viewcode-block" id="iterated_removal_cl_with_explanation"><a class="viewcode-back" href="../../iterative_methods.html#pref_voting.iterative_methods.iterated_removal_cl_with_explanation">[docs]</a><span class="k">def</span> <span class="nf">iterated_removal_cl_with_explanation</span><span class="p">(</span><span class="n">edata</span><span class="p">,</span> <span class="n">curr_cands</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Iterated Removal Condorcet Loser with an explanation. In addition to the winner(s), return the order of elimination, where each candidate in the list is a Condorcet loser in the profile (restricted to the remaining candidates). </span>

<span class="sd">    Args:</span>
<span class="sd">        edata (Profile, ProfileWithTies, MajorityGraph, MarginGraph): Any election data that has a `condorcet_loser` method. </span>
<span class="sd">        curr_cands (List[int], optional): If set, then find the winners for the profile restricted to the candidates in ``curr_cands``</span>

<span class="sd">    Returns: </span>
<span class="sd">        A sorted list of candidates</span>

<span class="sd">    :Example: </span>

<span class="sd">    .. exec_code:: </span>

<span class="sd">        from pref_voting.profiles import Profile</span>
<span class="sd">        from pref_voting.iterative_methods import iterated_removal_cl_with_explanation</span>
<span class="sd">        </span>
<span class="sd">        prof = Profile([[2, 1, 3, 0], [2, 1, 0, 3], [3, 1, 2, 0], [1, 2, 3, 0]], [1, 1, 1, 1])</span>

<span class="sd">        prof.display()</span>
<span class="sd">        ws, exp = iterated_removal_cl_with_explanation(prof)</span>
<span class="sd">        print(f&quot;The winning set is {ws}&quot;)</span>
<span class="sd">        print(f&quot;The order of elimination is {exp}&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">elim_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="n">condorcet_loser</span> <span class="o">=</span> <span class="n">edata</span><span class="o">.</span><span class="n">condorcet_loser</span><span class="p">(</span><span class="n">curr_cands</span> <span class="o">=</span> <span class="n">curr_cands</span><span class="p">)</span>  
    
    <span class="n">remaining_cands</span> <span class="o">=</span> <span class="n">edata</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">curr_cands</span>
    
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">remaining_cands</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span>  <span class="n">condorcet_loser</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
        <span class="n">elim_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">condorcet_loser</span><span class="p">)</span>   
        <span class="n">remaining_cands</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">remaining_cands</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">condorcet_loser</span><span class="p">]]</span>
        <span class="n">condorcet_loser</span> <span class="o">=</span> <span class="n">edata</span><span class="o">.</span><span class="n">condorcet_loser</span><span class="p">(</span><span class="n">curr_cands</span> <span class="o">=</span> <span class="n">remaining_cands</span><span class="p">)</span>
            
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">remaining_cands</span><span class="p">),</span> <span class="n">elim_list</span></div>

<div class="viewcode-block" id="iterated_split_cycle"><a class="viewcode-back" href="../../iterative_methods.html#pref_voting.iterative_methods.iterated_split_cycle">[docs]</a><span class="nd">@vm</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Iterated Split Cycle&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">iterated_split_cycle</span><span class="p">(</span><span class="n">edata</span><span class="p">,</span> <span class="n">curr_cands</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">strength_function</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Iteratively remove candidates that are not Split Cycle winners until there is a unique winner or all remaining candidates are Split Cycle winners. </span>

<span class="sd">    Args:</span>
<span class="sd">        edata (Profile, ProfileWithTies, MajorityGraph, MarginGraph): Any election data with a margin method. </span>
<span class="sd">        curr_cands (List[int], optional): If set, then find the winners for the profile restricted to the candidates in ``curr_cands``</span>

<span class="sd">    .. seealso: </span>
<span class="sd">        :meth:pref_voting.margin_based_methods.split_cycle</span>

<span class="sd">    Returns: </span>
<span class="sd">        A sorted list of candidates</span>

<span class="sd">    :Example: </span>

<span class="sd">    .. exec_code:: </span>

<span class="sd">        from pref_voting.profiles import Profile</span>
<span class="sd">        from pref_voting.iterative_methods import iterated_split_cycle</span>
<span class="sd">        from pref_voting.margin_based_methods import split_cycle_faster</span>
<span class="sd">        </span>
<span class="sd">        prof = Profile([[2, 0, 3, 1], [2, 3, 0, 1], [3, 1, 2, 0], [2, 1, 3, 0], [3, 0, 1, 2], [1, 2, 3, 0]], [1, 1, 1, 1, 1, 2])</span>

<span class="sd">        prof.display()</span>
<span class="sd">        split_cycle_faster.display(prof)</span>
<span class="sd">        iterated_split_cycle.display(prof)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>    
    <span class="n">prev_sc_winners</span> <span class="o">=</span> <span class="n">edata</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">curr_cands</span>
    <span class="n">sc_winners</span> <span class="o">=</span> <span class="n">split_cycle_faster</span><span class="p">(</span><span class="n">edata</span><span class="p">,</span> <span class="n">curr_cands</span> <span class="o">=</span> <span class="n">curr_cands</span><span class="p">,</span> <span class="n">strength_function</span> <span class="o">=</span> <span class="n">strength_function</span><span class="p">)</span>
    
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">sc_winners</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">sc_winners</span> <span class="o">!=</span> <span class="n">prev_sc_winners</span><span class="p">:</span> 
        <span class="n">prev_sc_winners</span> <span class="o">=</span> <span class="n">sc_winners</span>
        <span class="n">sc_winners</span> <span class="o">=</span> <span class="n">split_cycle_faster</span><span class="p">(</span><span class="n">edata</span><span class="p">,</span> <span class="n">curr_cands</span> <span class="o">=</span> <span class="n">sc_winners</span><span class="p">,</span> <span class="n">strength_function</span> <span class="o">=</span> <span class="n">strength_function</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">sc_winners</span><span class="p">)</span></div>

<span class="n">iterated_vms</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">instant_runoff</span><span class="p">,</span>
    <span class="n">instant_runoff_tb</span><span class="p">,</span>
    <span class="n">instant_runoff_put</span><span class="p">,</span>
    <span class="n">hare</span><span class="p">,</span>
    <span class="n">ranked_choice</span><span class="p">,</span>
    <span class="n">plurality_with_runoff</span><span class="p">,</span>
    <span class="n">coombs</span><span class="p">,</span>
    <span class="n">coombs_tb</span><span class="p">,</span>
    <span class="n">coombs_put</span><span class="p">,</span>
    <span class="n">strict_nanson</span><span class="p">,</span>
    <span class="n">weak_nanson</span><span class="p">,</span>
    <span class="n">baldwin</span><span class="p">,</span>
    <span class="n">baldwin_tb</span><span class="p">,</span>
    <span class="n">baldwin_put</span><span class="p">,</span>
    <span class="n">iterated_removal_cl</span><span class="p">,</span>
    <span class="n">iterated_split_cycle</span>
<span class="p">]</span>

<span class="n">iterated_vms_with_explanation</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">instant_runoff_with_explanation</span><span class="p">,</span>
    <span class="n">coombs_with_explanation</span><span class="p">,</span>
    <span class="n">baldwin_with_explanation</span><span class="p">,</span>
    <span class="n">strict_nanson_with_explanation</span><span class="p">,</span>
    <span class="n">weak_nanson_with_explanation</span><span class="p">,</span>
    <span class="n">iterated_removal_cl_with_explanation</span><span class="p">,</span>
<span class="p">]</span>

</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022, Eric Pacuit and Wes Holliday
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/scripts/furo.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    </body>
</html>